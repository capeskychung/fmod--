* CPU性能
    * 介绍
        * 混合器是什么?它是如何测量的?
        * 还有什么可以衡量的?
    * 声音限制
    * 提示和技巧
        * 采样率
        * DSP的块大小
        * 通道数
        * DSP Choice
    * 封装


#### 介绍
测量和调整性能是任何应用程序的重要组成部分，能够将FMOD从低功耗便携式设备扩展到最新的下一代控制台是我们设计的关键。本指南应该让您牢固地了解如何配置FMOD，以符合您的音频预算与具体的提示，无论您的目标平台是什么

在我们进入细节之前，让我们首先考虑如何在FMOD中度量性能。当我们讨论某个东西有多贵时，我们使用的主要度量是CPU百分比。我们可以通过测量执行一个动作所花费的时间，并将其与已知的时间窗进行比较来计算，最常见的例子是DSP或混频器性能。

##### 混合器是什么?它是如何测量的?
当我们谈论混音器性能时，我们实际上是在谈论发送到输出(通常是您的扬声器)的音频样本的生成。我们的混频器将定期产生一个样品缓冲器，代表一定数量的时间回放。我们称其为DSP块大小，它通常默认为512个样本，当以48KHz播放时，它表示约10ms的音频。

定期生产固定数量的样品后，我们现在可以测量生产这些样品需要多长时间，并得到一个百分比。例如，如果我们花费5毫秒的CPU时间来产生10毫秒的音频，我们的混音器性能将是50%。当CPU时间接近10ms时，我们可能无法及时交付音频，从而导致音频不连续，即所谓的口吃。

##### 还有什么可以衡量的?
另一个关键性能区域是update，定期调用此操作来执行运行时内务管理。我们的建议是每次渲染帧调用update一次，通常每秒30或60次。使用已知的30或60帧每秒的时间帧，我们现在可以测量执行此操作所花费的CPU时间，以获得百分比。

有了度量性能的能力，我们现在需要确定哪些东西花费了大量CPU时间。最常被引用的贡献者是语音计数，其逻辑是播放更多的声音将占用更多的CPU时间。以下是影响声音回放成本的主要因素:
* 解码压缩音频到PCM
* 重新采样PCM到适当的音高
* 应用DSP效果的声音
* 将音频与其他声音混合，生成您听到的最终输出

为您想要播放的音频类型和平台选择正确的压缩格式是控制CPU成本的重要部分。有关格式选择的建议，请参阅本平台的性能参考资料。

#### 声音限制
一旦确定了压缩格式，就需要决定希望同时听到多少这种格式的声音。有三种方法可以用来控制可播放声音的数量:
System::init (maxChannels…)同时播放的声音的最大数量。   
System:setSoftwareChannels (numSoftwareChannels)最大可听到的声音数量。  
FMOD_ADVANCEDSETTINGS马克斯? ? ?编解码器的最大数量在哪里??是压缩格式。  
要深入了解虚拟语音系统的工作原理和进一步控制语音计数的方法，请参考虚拟语音教程。  

通常很难判断在上述三种设置中使用哪些值比较好。粗略地说，maxChannels应该足够高，在正常情况下不会触及上限，所以256、512甚至1024是合理的选择。选择numSoftwareChannels和maxCodecs的值将取决于使用的平台和格式。为了帮助选择这些值，我们在这个平台的性能参考文档中提供了一些建议和基准。

#### 提示和技巧
使用正确配置的压缩格式和适当的语音计数，您就可以很好地实现高效配置的设置。接下来是一系列的技巧来考虑你的项目，并不是所有的都适用，但他们应该考虑从FMOD获得最好的性能。

##### 采样率
优化时需要考虑两种采样速率，系统速率和源音频速率。您可以使用System::setSoftwareFormat (sampleRate，…)来控制系统采样率，默认情况下，该格式为48KHz。减少这一点可以在性能上取得一些重大胜利，因为生成的数据更少。这个设置是性能和质量之间的权衡。

要控制源音频速率，可以使用您喜爱的音频编辑器重新采样，或者使用FSBank工具或FSBankLib API进行压缩时使用示例速率设置。所有音频将发送到一个重新采样器，当它在运行时播放，如果源采样率和系统速率匹配，那么重新采样器可以跳过，节省CPU时间。请注意，只有在没有对频道应用音高/频率设置时才会发生这种情况，所以这个技巧通常对音乐很有用。

##### DSP的块大小
如前所述，这表示定期生产的固定数量的样品被发送给扬声器。在生成每个示例块时，开销是固定的，因此增大块大小可以降低总体CPU成本。您可以使用System::setDSPBufferSize(块长，…)控制该设置，根据平台的不同，该设置通常默认为512或1024个示例。

与此设置的权衡是CPU与混频器粒度之间的权衡，有关更改此设置的影响的更多信息，请参考该函数的API参考。

##### 通道数
控制正在播放的音频的频道数量会对性能产生很大的影响，考虑一个简单的数学问题:7.1 surround要处理的数据是stereo的四倍。有几个不同的地方可以通过控制信道数来提高性能。  
声源声道计数应仔细选择，通常单声源是最好的，特别是声音将定位在三维。减少源的信道数是一种简单的方法，也会减少解码该声音的时间。

设置系统频道计数将控制3D声音在世界上给定位置时的平移方式。通过指定表示众所周知的扬声器配置(如7.1环绕立体声或立体声)的扬声器模式，可以设置此信道计数。使用System::setSoftwareFormat(…，默认值将匹配您的输出设备设置。
作为一个更高级的设置，您可以限制由子混合产生的通道数量，或进入特定DSP效果的通道数量。这对于将通道限制为昂贵的DSP效果特别有用。控制这个的API是DSP::setChannelFormat(…默认情况下，这将是前一个DSP单元的输出。

##### DSP Choice
并不是所有的dsp都是相同的，有些在计算上很简单并且只使用很少的CPU，其他的则非常昂贵。当决定使用特定的效果时，对目标硬件进行概要分析以充分理解CPU含义是很重要的。
DSP的定位可以产生很大的不同，对每个语音都施加影响可能会花费大量的CPU时间。对于每种效果的定位没有严格的规则，但举个例子，通常低通和高通DSP效果可以有效地使用每个声音，但混响往往只有一个实例，所有的声音发送到一个子混合。

#### 封装
希望现在您已经很好地理解了用于优化FMOD使用的选项。如果对您的具体设置有疑问，请联系support@fmod.com，我们非常乐意与您讨论您的具体要求。
